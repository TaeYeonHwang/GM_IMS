<script>
  // ===== ì—¬ê¸°ë¶€í„° ì¶”ê°€ =====
const CameraModule = {
  streams: {
    barcode: null,
    qr: null,
    orderQR: null
  },
  
  async start(type, config) {
    const { videoElement, containerElement, buttonTextElement, captureButtonElement, resultElement } = config;
    
    if (containerElement.style.display === 'block') {
      this.stop(type, config);
      return;
    }
    
    if (resultElement) {
      resultElement.innerHTML = '<div class="alert alert-info">ì¹´ë©”ë¼ë¥¼ ì‹œì‘í•˜ëŠ” ì¤‘...</div>';
    }
    
    try {
      const stream = await navigator.mediaDevices.getUserMedia({
        video: { facingMode: 'environment', width: { ideal: 1280 }, height: { ideal: 720 } },
        audio: false
      });
      
      this.streams[type] = stream;
      videoElement.srcObject = stream;
      containerElement.style.display = 'block';
      if (captureButtonElement) captureButtonElement.style.display = 'flex';
      
      videoElement.onloadedmetadata = () => {
        videoElement.play().then(() => {
          if (buttonTextElement) buttonTextElement.textContent = 'ì¹´ë©”ë¼ ë„ê¸°';
          if (resultElement) {
            const scanType = type === 'barcode' ? 'ë°”ì½”ë“œ' : 'QR ì½”ë“œ';
            resultElement.innerHTML = `<div class="alert alert-info">ğŸ“¸ ${scanType}ë¥¼ ë…¹ìƒ‰ ì˜ì—­ì— ë§ì¶”ê³  ìº¡ì²˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</div>`;
          }
        }).catch(() => {
          if (resultElement) resultElement.innerHTML = '<div class="alert alert-error">ë¹„ë””ì˜¤ ì¬ìƒ ì‹¤íŒ¨</div>';
          this.stop(type, config);
        });
      };
    } catch (error) {
      if (resultElement) {
        resultElement.innerHTML = `<div class="alert alert-error">ì¹´ë©”ë¼ë¥¼ ì‹œì‘í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ${error.message}</div>`;
      }
      this.stop(type, config);
    }
  },
  
  stop(type, config) {
    const stream = this.streams[type];
    if (stream) {
      stream.getTracks().forEach(track => track.stop());
      this.streams[type] = null;
    }
    
    const { videoElement, containerElement, captureButtonElement, buttonTextElement } = config;
    videoElement.srcObject = null;
    containerElement.style.display = 'none';
    if (captureButtonElement) captureButtonElement.style.display = 'none';
    if (buttonTextElement) buttonTextElement.textContent = 'ì¹´ë©”ë¼ë¡œ ìŠ¤ìº”';
  },
  
  captureImage(videoElement, canvasElement) {
    const canvas = canvasElement;
    const video = videoElement;
    const ctx = canvas.getContext('2d');
    
    if (video.videoWidth === 0 || video.videoHeight === 0) {
      throw new Error('ë¹„ë””ì˜¤ê°€ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
    }
    
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
    
    return ctx.getImageData(0, 0, canvas.width, canvas.height);
  }
};
// ===== ì—¬ê¸°ê¹Œì§€ ì¶”ê°€ =====

</script>
